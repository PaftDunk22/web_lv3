<!DOCTYPE html>
	<html lang="hr">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="movies ranking">
        <meta name="keywords" content="movies">
        <link rel="stylesheet" href="style.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
		<title>LV1_zad1_web_OA</title> 
	</head>
	<body>
		<header>
		<h1>Movies</h1>
		</header>
		<nav aria-labelledby="primarna-navigacija">
			<ul>
                <li><a href="grafikon.html">Grafikon</a></li>
                <li><a href="slike.html">Galerija Slika</a></li>
                <li class="dropdown">
                  <a href="javascript:void(0)" class="dropbtn">Contact List</a>
                  <section class="dropdown-content">
                    <a href="#">Contact 1</a>
                    <a href="#">Contact 2</a>
                    <a href="#">Contact 3</a>
                  </section>
                </li>
              </ul>
		</nav>

        <picture>
            <source media="(min-width: 650px)" srcset="movies.jpg" alt="Various movies to be ranked">
            <source media="(min-width: 465px)" srcset="movies.jpg" alt="Various movies to be ranked">
            <img src="movies_mobile.png" alt="Various movies to be ranked">
          </picture>

        

		<h1>Popis Filmova</h1>
		
		<section class="main">
        
            <aside>
                <img src="kurosawa.jpg" alt="Akira Kurosawa">
                </aside>


            <!-- Filtri -->
            <div id="filteri">
                <select id="filter-genre">
                <option value="">-- Odaberi zanr --</option>
                <option value="Comedy">Comedy</option>
                <option value="Drama">Drama</option>
                <option value="Action">Action</option>
                <option value="Sci-Fi">Sci-Fi</option>
                <option value="Crime">Crime</option>
                </select>
                <input type="number" id="filter-year" placeholder="Godina od">
                <input type="number" id="duration" placeholder="Trajanje filma">
                </select>
                <input type="range" id="filter-rating" min="0" max="10" step=0.1 value="7">
                <span id="rating-value">7</span>
                <button id="primijeni-filtere">Filtriraj</button>
                </div>
            <table id="filmovi-tablica">
                <thead>
                <tr>
                <th>title</th>
                <th>year</th>
                <th>genre</th>
                <th>duration</th>
                <th>rating</th>
                <th>directors</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
                </table>    

        </section>

		<section aria-labelledby="movies I like"> 
			<h2>Movies I like</h2>
			<p>Here are some of the movies I like:
			V for Vendetta <br>
			Book of Eli <br>
			Oldboy <br>
			Parasite <br>
			Memories of Murder <br>
			Prestige <br>
			Ghost in the Shell <br>
			Akira <br>
			...and many more
			
			</p>
			
		</section>
		<article>
			<h2>Huge movie buff:</h2>
			<p class= "animation"> 
		<img src="movie_buff.jpg" alt = "Quentin Tarantino">
		
		</p>
		</article>

		<footer>
		<p>&copy; 2025. Web Programiranje. Sva prava pridrzana.</p>
		</footer>

	</body>
</html>

<script>

    let sviFilmovi = [];
    fetch('movies.csv')
      .then(res => res.text())
      .then(csv => {
        const rezultat = Papa.parse(csv, {
          header: true,
          skipEmptyLines: true
        });
    
        sviFilmovi = rezultat.data.map(film => ({
          title: film.title,
          year: Number(film.year),
          genre: film.genre,
          duration: Number(film.duration),
          director: film.director?.trim() || '',
          rating: Number(film.rating), // Assuming the CSV has a "rating" column
          total_votes: Number(film.total_votes)
        }));
    
        // Display the initial movies and filtered movies
        prikaziPocetneFilmove(sviFilmovi.slice(0, 10));
        prikaziFiltriraneFilmove(sviFilmovi.slice(0, 10));
      })
      .catch(err => {
        console.error('Greška pri dohvaćanju CSV-a:', err);
      });
    
    function prikaziPocetneFilmove(filmovi) {
      const tbody = document.querySelector('#filmovi-tablica tbody');
      tbody.innerHTML = '';
      for (const film of filmovi) {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${film.title}</td>
          <td>${film.year}</td>
          <td>${film.genre}</td>
          <td>${film.duration} min</td>
          <td>${film.director}</td>
          <td>${film.rating}</td>
        `;
        tbody.appendChild(row);
      }
    }
    
    const rangeInput = document.getElementById('filter-rating');
    const ratingDisplay = document.getElementById('rating-value');
    rangeInput.addEventListener('input', () => {
      ratingDisplay.textContent = rangeInput.value;
    });
    
    function filtriraj() {
      const zanr = document.getElementById('filter-genre').value.trim().toLowerCase();
      const godinaOd = parseInt(document.getElementById('filter-year-from').value);
      const redatelj = document.getElementById('filter-director').value.trim().toLowerCase();
      const ocjena = parseFloat(document.getElementById('filter-rating').value);
    
      const filtriraniFilmovi = sviFilmovi.filter(film => {
        const zanrMatch = !zanr || film.genre.toLowerCase().includes(zanr);
        const godinaOdMatch = !godinaOd || film.year >= godinaOd;
        const redateljMatch = !redatelj || film.director.toLowerCase().includes(redatelj);
        const ocjenaMatch = film.rating >= ocjena;
        return zanrMatch && godinaOdMatch && redateljMatch && ocjenaMatch;
      });
    
      prikaziFiltriraneFilmove(filtriraniFilmovi);
    }
    
    // Ensure the filter button triggers the filter function correctly
    document.getElementById('primijeni-filtere').addEventListener('click', (event) => {
      event.preventDefault(); // Prevent form submission (if it's in a form)
      filtriraj();
    });
    
    function prikaziFiltriraneFilmove(filmovi) {
      const tbody = document.querySelector('#filtriranje_tablica tbody');
      tbody.innerHTML = '';
      if (filmovi.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6">Nema filmova za odabrane filtre.</td></tr>';
        return;
      }
      for (const film of filmovi) {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${film.title}</td>
          <td>${film.year}</td>
          <td>${film.genre}</td>
          <td>${film.duration} min</td>
          <td>${film.director}</td>
          <td>${film.rating}</td>
        `;
        tbody.appendChild(row);
      }
    }
    
            

</script>